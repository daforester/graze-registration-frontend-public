import{d as He,p as Le,a9 as We,t as F,c as U,s as ye,aa as Me,h as a,m as te,ad as Qe,J as ae,i as j,r as R,C as Oe,O as se,L as J,$ as qe,D as x,l as L,n as y,A as ne,q as o,v as b,G as d,x as k,H as C,Q as G,F as ge}from"./index-DWoJBaAj.js";import{u as re}from"./useConventionSlug-CkFQ5rCe.js";import{V as oe}from"./VContainer-BFcMrVbM.js";import{V as z,a as P}from"./VRow-t6XUObGt.js";import{u as ze,m as je,a as Je,V as Te}from"./VSelect-CyajT2HP.js";import{V as Ke}from"./VSpacer-qSTNPCcP.js";import{u as Xe,V as q,o as Ye}from"./VGrid-BjgFpAZn.js";import{e as ie}from"./VCard-Bh0GtTSC.js";import{c as Ze,b as et,e as tt,u as at,k as lt,p as ot,s as st,g as nt,h as rt,i as it,j as ut,m as he,n as ke,t as mt,q as dt,v as ct,V as xe}from"./VDataTable-DX8BXXOk.js";import{u as pt,m as vt}from"./filter-BnNNQUzF.js";import{V as Ve}from"./VTable-BRlXJ9u2.js";import{_ as Re,C as ft,a as yt}from"./EmailControl.vue_vue_type_script_setup_true_lang-C5l5FSLu.js";import{V as gt}from"./forwardRefs-DoDzwsLS.js";import{V as be}from"./VList-BQEmKFTx.js";import{V as ht}from"./VSheet-BC3ozFky.js";import{a as kt,b as le,c as Vt,V as Tt}from"./VTabs-Dyid0o6g.js";import{V as xt}from"./VToolbar-CHLZske4.js";import"./VTextField-DEVkKC1W.js";import"./form-B38mwiHr.js";import"./VOverlay-CpOp3qgP.js";import"./scopeId-Cl_fsoSS.js";import"./VCheckboxBtn-hdHe9uQb.js";import"./VChip-BZ6_PRg8.js";import"./createSimpleFunctional-D3jYYgwj.js";import"./EmailEditor.vue_vue_type_script_setup_true_lang-DTatkPKs.js";import"./permission-CXLcAQMS.js";import"./useConventionForms-BuKmEUF4.js";import"./VDialog-yG2h32Ey.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-CxMvc_Zx.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-CH1oplkq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAlert-DnYhM54q.js";const Rt=Le({...Qe(dt(),["hideDefaultFooter"]),...mt(),...je(),...vt()},"VDataTableVirtual"),bt=He()({name:"VDataTableVirtual",props:Rt(),emits:{"update:modelValue":s=>!0,"update:sortBy":s=>!0,"update:options":s=>!0,"update:groupBy":s=>!0,"update:expanded":s=>!0},setup(s,A){let{attrs:_,slots:l}=A;const{groupBy:D}=Ze(s),{sortBy:N,multiSort:f,mustSort:g}=et(s),{disableSort:v}=We(s),{columns:V,headers:w,filterFunctions:$,sortFunctions:I,sortRawFunctions:h}=tt(s,{groupBy:D,showSelect:F(()=>s.showSelect),showExpand:F(()=>s.showExpand)}),{items:m}=at(s,V),r=F(()=>s.search),{filteredItems:i}=pt(s,m,r,{transform:S=>S.columns,customKeyFilter:$}),{toggleSort:c}=lt({sortBy:N,multiSort:f,mustSort:g}),{sortByWithGroups:W,opened:K,extractRows:X,isGroupOpen:Y,toggleGroup:n}=ot({groupBy:D,sortBy:N,disableSort:v}),{sortedItems:e}=st(s,i,W,{transform:S=>({...S.raw,...S.columns}),sortFunctions:I,sortRawFunctions:h}),{flatItems:t}=nt(e,D,K),u=U(()=>X(t.value)),{isSelected:p,select:T,selectAll:M,toggleSelect:Q,someSelected:O,allSelected:Z}=rt(s,{allItems:u,currentPage:u}),{isExpanded:De,toggleExpand:we}=it(s),{containerRef:Ie,markerRef:Ce,paddingTop:Ue,paddingBottom:_e,computedItems:Ne,handleItemResize:Se,handleScroll:Ae,handleScrollend:$e,calculateVisibleItems:Ee,scrollToIndex:Be}=ze(s,t),Fe=U(()=>Ne.value.map(S=>S.raw));ut({sortBy:N,page:ye(1),itemsPerPage:ye(-1),groupBy:D,search:r}),Me({VDataTableRows:{hideNoData:F(()=>s.hideNoData),noDataText:F(()=>s.noDataText),loading:F(()=>s.loading),loadingText:F(()=>s.loadingText)}});const E=U(()=>({sortBy:N.value,toggleSort:c,someSelected:O.value,allSelected:Z.value,isSelected:p,select:T,selectAll:M,toggleSelect:Q,isExpanded:De,toggleExpand:we,isGroupOpen:Y,toggleGroup:n,items:u.value.map(S=>S.raw),internalItems:u.value,groupedItems:t.value,columns:V.value,headers:w.value}));return Xe(()=>{const S=he.filterProps(s),Ge=ke.filterProps(s),Pe=Ve.filterProps(s);return a(Ve,te({class:["v-data-table",{"v-data-table--loading":s.loading},s.class],style:s.style},Pe,{fixedHeader:s.fixedHeader||s.sticky}),{top:()=>{var B;return(B=l.top)==null?void 0:B.call(l,E.value)},wrapper:()=>{var B,ue,me,de,ce,pe;return a("div",{ref:Ie,onScrollPassive:Ae,onScrollend:$e,class:"v-table__wrapper",style:{height:ae(s.height)}},[a("table",null,[(B=l.colgroup)==null?void 0:B.call(l,E.value),!s.hideDefaultHeader&&a("thead",{key:"thead"},[a(he,S,l)]),(ue=l.thead)==null?void 0:ue.call(l,E.value),!s.hideDefaultBody&&a("tbody",{key:"tbody"},[a("tr",{ref:Ce,style:{height:ae(Ue.value),border:0}},[a("td",{colspan:V.value.length,style:{height:0,border:0}},null)]),(me=l["body.prepend"])==null?void 0:me.call(l,E.value),a(ke,te(_,Ge,{items:Fe.value}),{...l,item:H=>a(Je,{key:H.internalItem.index,renderless:!0,"onUpdate:height":ee=>Se(H.internalItem.index,ee)},{default:ee=>{var fe;let{itemRef:ve}=ee;return((fe=l.item)==null?void 0:fe.call(l,{...H,itemRef:ve}))??a(ct,te(H.props,{ref:ve,key:H.internalItem.index,index:H.internalItem.index}),l)}})}),(de=l["body.append"])==null?void 0:de.call(l,E.value),a("tr",{style:{height:ae(_e.value),border:0}},[a("td",{colspan:V.value.length,style:{height:0,border:0}},null)])]),(ce=l.tbody)==null?void 0:ce.call(l,E.value),(pe=l.tfoot)==null?void 0:pe.call(l,E.value)])])},bottom:()=>{var B;return(B=l.bottom)==null?void 0:B.call(l,E.value)}})}),{calculateVisibleItems:Ee,scrollToIndex:Be}}}),Dt={class:"my-4"},wt={class:"d-flex ml-4"},It={class:"mx-4"},Ct={class:"my-4"},Ut={class:"d-flex ml-4"},_t={class:"mx-4"},Nt={class:"my-4"},St={class:"d-flex ml-4"},At={class:"mx-4"},$t=j({__name:"HotelReport",emits:["pageTitle"],async setup(s,{emit:A}){let _,l;const{getConvention:D}=re();A("pageTitle","Reports");const f=se(),g=J(),v=R([]),V=R(),w=R([]);try{const n=([_,l]=Oe(()=>D()),_=await _,l(),_);n&&(f.getHotelReport(n.ConventionUUID).then(e=>{v.value=e}),f.getConventionVenues(n.ConventionUUID).then(e=>{w.value=e}))}catch{g.push("/")}const $=U(()=>[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Address",align:"start",key:"Address"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]),I=U(()=>{const n=[];return v.value.forEach(e=>{V.value&&e.Venue!=V.value||e.Guests.forEach((t,u)=>{const p={FirstName:"",LastName:"",Guests:"",Address:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};p.FirstName=t.FirstName,p.LastName=t.LastName,p.Address=t.Address;const T=e.Guests.filter((O,Z)=>Z!==u);let M="";T.forEach(O=>{M+=O.FirstName+" "+O.LastName+","}),p.Guests=M.substring(0,M.length-1),p.Venue=e.Venue;const Q=e.Accommodation.match(/\((.*?)\)/);Q&&Q.length>=1?p.Accommodation=Q[1]:p.Accommodation=e.Accommodation,p.RoomType=e.RoomType,p.ArrivalDay=e.Days[0],p.DepartureDay=e.Days[e.Days.length-1],n.push(p)})}),n}),h=U(()=>{const n=new Map;return v.value.forEach(e=>{let t;const u=`${e.Days[0]} - ${e.Days[e.Days.length-1]}`;n.has(u)?t=n.get(u):t=new Map,t.has(e.Accommodation)?t.set(e.Accommodation,t.get(e.Accommodation)+1):t.set(e.Accommodation,1),n.set(u,t)}),n.forEach((e,t)=>{n.set(t,new Map([...e.entries()].sort()))}),n}),m=U(()=>{const n=new Map;return v.value.forEach(e=>{let t;const u=`${e.Days[0]} - ${e.Days[e.Days.length-1]}`;n.has(u)?t=n.get(u):t=new Map,t.has(e.RoomType)?t.set(e.RoomType,t.get(e.RoomType)+1):t.set(e.RoomType,1),n.set(u,t)}),n.forEach((e,t)=>{n.set(t,new Map([...e.entries()].sort()))}),n}),r=U(()=>{const n=new Map;return v.value.forEach(e=>{let t;const u=`${e.Days[0]} - ${e.Days[e.Days.length-1]}`;n.has(u)?t=n.get(u):t=new Map,t.has(`${e.Accommodation} (${e.RoomType})`)?t.set(`${e.Accommodation} (${e.RoomType})`,t.get(`${e.Accommodation} (${e.RoomType})`)+1):t.set(`${e.Accommodation} (${e.RoomType})`,1),n.set(u,t)}),n.forEach((e,t)=>{n.set(t,new Map([...e.entries()].sort()))}),n}),i=qe("reportTable"),c="data:application/vnd.ms-excel;base64,",W='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',K=function(n){return btoa(unescape(encodeURIComponent(n)))},X=function(n,e){return n.replace(/{(\w+)}/g,function(t,u){return e[u]})},Y=n=>{var t;const e=(t=i.value)==null?void 0:t.getElementsByTagName("table")[0];if(e){const u={worksheet:n,table:e.innerHTML};window.location.href=c+K(X(W,u))}};return(n,e)=>v.value.length>0&&w.value.length>0?(y(),x(C,{key:0},[a(oe,{fluid:""},{default:o(()=>[a(z,null,{default:o(()=>[a(P,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[a(Te,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),label:"Venue",items:w.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),a(Ke),a(P,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:o(()=>[a(q,{onClick:e[1]||(e[1]=t=>Y("Hotel Report")),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:o(()=>e[2]||(e[2]=[b(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),I.value?(y(),L(ie,{key:0,class:"pa-2"},{default:o(()=>[d("div",{ref_key:"reportTable",ref:i},[a(bt,{headers:$.value,items:I.value,"items-length":I.value.length},{"item.RoomType":o(({item:t})=>[b(k(t.RoomType)+" ",1),e[3]||(e[3]=d("br",null,null,-1)),b(" ("+k(t.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"])],512),a(z,null,{default:o(()=>[a(P,{cols:"12",md:"6",lg:"4"},{default:o(()=>[d("div",null,[e[4]||(e[4]=d("h2",{class:"my-4"},"Room Count Summary",-1)),d("dl",null,[(y(!0),x(C,null,G(h.value.entries(),([t,u])=>(y(),x(C,null,[d("dt",Dt,[d("strong",null,k(t),1)]),(y(!0),x(C,null,G(u.entries(),([p,T])=>(y(),x("dd",null,[d("dl",wt,[d("dt",It,k(p),1),d("dd",null,k(T),1)])]))),256)),b(" Total: "+k(u.entries().reduce((p,T)=>p+T[1],0)),1)],64))),256))])])]),_:1}),a(P,{cols:"12",md:"6",lg:"4"},{default:o(()=>[d("div",null,[e[5]||(e[5]=d("h2",{class:"my-4"},"Allocation Summary",-1)),d("dl",null,[(y(!0),x(C,null,G(m.value.entries(),([t,u])=>(y(),x(C,null,[d("dt",Ct,[d("strong",null,k(t),1)]),(y(!0),x(C,null,G(u.entries(),([p,T])=>(y(),x("dd",null,[d("dl",Ut,[d("dt",_t,k(p),1),d("dd",null,k(T),1)])]))),256)),b(" Total: "+k(u.entries().reduce((p,T)=>p+T[1],0)),1)],64))),256))])])]),_:1}),a(P,{cols:"12",md:"6",lg:"4"},{default:o(()=>[d("div",null,[e[6]||(e[6]=d("h2",{class:"my-4"},"Split Summary",-1)),d("dl",null,[(y(!0),x(C,null,G(r.value.entries(),([t,u])=>(y(),x(C,null,[d("dt",Nt,[d("strong",null,k(t),1)]),(y(!0),x(C,null,G(u.entries(),([p,T])=>(y(),x("dd",null,[d("dl",St,[d("dt",At,k(p),1),d("dd",null,k(T),1)])]))),256)),b(" Total: "+k(u.entries().reduce((p,T)=>p+T[1],0)),1)],64))),256))])])]),_:1})]),_:1})]),_:1})):ne("",!0)],64)):(y(),L(oe,{key:1},{default:o(()=>[a(z,null,{default:o(()=>[a(P,{class:"text-center"},{default:o(()=>[a(Ye,{indeterminate:"",color:"primary",size:"100",width:"10"},{default:o(()=>e[7]||(e[7]=[b(" Loading ")])),_:1})]),_:1})]),_:1})]),_:1}))}}),Et={class:"flex-grow-1"},Bt=j({__name:"TicketReport",emits:["pageTitle"],setup(s,{emit:A}){const{getConvention:_}=re();A("pageTitle","Reports");const D=se(),N=J(),f=R(),g=R([]),v=R([]),V=R(!0),w=()=>{try{_().then(h=>{h&&(f.value=h,D.getTicketReport(f.value.ConventionUUID).then(m=>{g.value=m,V.value=!1}))})}catch{N.push("/")}},$=U(()=>[{title:"Reference",align:"start",key:"Reference"},{title:"Name",align:"start",key:"Name"},{title:"Ticket",align:"start",key:"Ticket"},{title:"QR Code",align:"start",key:"QRCode"}]),I=U(()=>g.value?g.value.map(h=>({RegistrationUUID:h.RegistrationUUID,Reference:h.Reference,Name:h.Name,Ticket:h.Ticket.map(r=>r.Name),QRCode:h.QRCode})):[]);return w(),(h,m)=>f.value&&g.value?(y(),L(ie,{key:0,class:"pa-2"},{default:o(()=>[a(xe,{modelValue:v.value,"onUpdate:modelValue":m[2]||(m[2]=r=>v.value=r),headers:$.value,items:I.value,"item-value":"RegistrationUUID","show-select":"",loading:V.value},{"item.Ticket":o(({item:r})=>[a(be,{items:r.Ticket},null,8,["items"])]),"item.QRCode":o(({item:r})=>[a(gt,{src:r.QRCode,alt:r.Reference},null,8,["src","alt"])]),"footer.prepend":o(()=>[d("div",Et,[a(q,{variant:"text",color:"primary",onClick:m[0]||(m[0]=r=>v.value=I.value.map(i=>i.RegistrationUUID))},{default:o(()=>m[6]||(m[6]=[b(" (Select all on every page) ")])),_:1}),a(q,{variant:"text",color:"primary",onClick:m[1]||(m[1]=r=>v.value=[])},{default:o(()=>m[7]||(m[7]=[b(" (Unselect all on every page) ")])),_:1})])]),_:2},1032,["modelValue","headers","items","loading"]),a(Re,{modelValue:v.value,"onUpdate:modelValue":m[3]||(m[3]=r=>v.value=r),details:I.value,"onUpdate:details":m[4]||(m[4]=r=>I.value=r),"model-type":"registration",convention:f.value,"onUpdate:convention":m[5]||(m[5]=r=>f.value=r)},null,8,["modelValue","details","convention"])]),_:1})):ne("",!0)}}),Ft={class:"flex-grow-1"},Gt=j({__name:"CheckInReport",emits:["pageTitle"],setup(s,{emit:A}){const{getConvention:_}=re();A("pageTitle","Reports");const D=se(),N=J(),f=R(),g=R([]),v=R([]),V=R(!0),w=R(),$=R([{key:"Reference",order:"asc"}]),I=()=>{try{_().then(r=>{var i;r&&(f.value=r,D.getCheckInReport((i=f.value)==null?void 0:i.ConventionUUID).then(c=>{g.value=c,V.value=!1}))})}catch{N.push("/")}},h=U(()=>[{title:"Reference",align:"start",key:"Reference"},{title:"Name",align:"start",key:"Name"},{title:"Ticket",align:"start",key:"Ticket"},{title:"Checked In",align:"start",key:"CheckedIn"}]),m=U(()=>g.value?g.value.filter(r=>w.value?r.CheckedIn===w.value:!0).map(r=>({RegistrationUUID:r.RegistrationUUID,Reference:r.Reference,Name:r.Name,Ticket:r.Ticket.map(c=>c.Name),CheckedIn:r.CheckedIn})):[]);return I(),(r,i)=>(y(),x(C,null,[a(oe,{fluid:""},{default:o(()=>[a(z,null,{default:o(()=>[a(P,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[a(Te,{modelValue:w.value,"onUpdate:modelValue":i[0]||(i[0]=c=>w.value=c),label:"Status",items:ge(ft),"item-value":"value","item-title":"title",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),f.value&&g.value?(y(),L(ie,{key:0,class:"pa-2"},{default:o(()=>[a(xe,{modelValue:v.value,"onUpdate:modelValue":i[3]||(i[3]=c=>v.value=c),headers:h.value,items:m.value,"item-value":"RegistrationUUID","show-select":"",loading:V.value,"sort-by":$.value,"onUpdate:sortBy":i[4]||(i[4]=c=>$.value=c)},{"item.CheckedIn":o(({item:c})=>[b(k(ge(yt)(c.CheckedIn)),1)]),"item.Ticket":o(({item:c})=>[a(be,{items:c.Ticket},null,8,["items"])]),"footer.prepend":o(()=>[d("div",Ft,[a(q,{variant:"text",color:"primary",onClick:i[1]||(i[1]=c=>v.value=m.value.map(W=>W.RegistrationUUID))},{default:o(()=>i[8]||(i[8]=[b(" (Select all on every page) ")])),_:1}),a(q,{variant:"text",color:"primary",onClick:i[2]||(i[2]=c=>v.value=[])},{default:o(()=>i[9]||(i[9]=[b(" (Unselect all on every page) ")])),_:1})])]),_:2},1032,["modelValue","headers","items","loading","sort-by"]),a(Re,{modelValue:v.value,"onUpdate:modelValue":i[5]||(i[5]=c=>v.value=c),details:m.value,"onUpdate:details":i[6]||(i[6]=c=>m.value=c),"model-type":"registration",convention:f.value,"onUpdate:convention":i[7]||(i[7]=c=>f.value=c)},null,8,["modelValue","details","convention"])]),_:1})):ne("",!0)],64))}}),ga=j({__name:"Reports",emits:["pageTitle"],setup(s,{emit:A}){A("pageTitle","Reports"),J();const l=R("Hotel"),D=R(["Hotel","Tickets","Check In"]);return(N,f)=>(y(),L(ht,null,{default:o(()=>[a(xt,{color:"blue-darken-4"},{default:o(()=>[a(kt,{modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=g=>l.value=g),"show-arrows":""},{default:o(()=>[(y(!0),x(C,null,G(D.value,g=>(y(),L(Tt,null,{default:o(()=>[b(k(g),1)]),_:2},1024))),256))]),_:1},8,["modelValue"])]),_:1}),a(Vt,{modelValue:l.value,"onUpdate:modelValue":f[1]||(f[1]=g=>l.value=g)},{default:o(()=>[a(le,{value:"Hotel"},{default:o(()=>[a($t)]),_:1}),a(le,{value:"Tickets"},{default:o(()=>[a(Bt)]),_:1}),a(le,{value:"Check In"},{default:o(()=>[a(Gt)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ga as default};
