import{s as b}from"./index-zHJ-1AxG.js";import{i as k,r as U,U as h,l as M,n as w,q as v,h as o,v as O,F as A,O as G,M as C,N as W,c as L,w as Y,D as j,H as P}from"./index-7f8g6J9S.js";import{v as E}from"./v4-CtRu48qb.js";import{e as F,c as q}from"./VCard-DG_UKHGE.js";import{V as x,a as z}from"./VToolbar-C228vxfP.js";import{V as S,d as J}from"./VGrid-Di0dmjBj.js";import{V as H}from"./VSpacer-ClTsySPd.js";import{V as Q}from"./VToolbarItems-CQ05XBiQ.js";import{V as X}from"./VContainer-Bgspm0iQ.js";import{V as Z,a as R}from"./VRow-DPqCOOhq.js";import{V as K}from"./VTextField-BHH-kiyo.js";import{V as _}from"./VAutocomplete-BlLyKZgC.js";import{a as ee,b as ae}from"./VList-CWj7M1gi.js";import{V as le}from"./VDialog-otOa-Jrf.js";var u=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.TAG=2]="TAG",e[e.STRING=3]="STRING",e[e.UUID_ARRAY=4]="UUID_ARRAY",e[e.OPTION=5]="OPTION",e))(u||{});const te=k({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(e,{emit:N}){const s=U(""),m=U("");typeof e.convention=="object"?(s.value=e.convention.ConventionUUID,m.value=e.convention.OrganisationUUID):s.value=e.convention||"",typeof e.organisation=="object"?m.value=e.organisation.OrganisationUUID:m.value.length===0&&(m.value=e.organisation||"");const i=N,g=U({ID:0,TagUUID:E(),ConventionID:0,ConventionUUID:s.value||h,OrganisationID:0,OrganisationUUID:m.value||h,Title:"",Key:""}),c=G(),T=()=>{c.saveTag(g.value).then(f=>{f&&(g.value=f,i("save",f),i("close"))})};return(f,t)=>(w(),M(F,null,{default:v(()=>[o(x,{dark:"",color:"primary"},{default:v(()=>[o(S,{icon:"",dark:"",onClick:t[0]||(t[0]=d=>i("close"))},{default:v(()=>[o(J,null,{default:v(()=>t[3]||(t[3]=[O("mdi:mdi-close")])),_:1})]),_:1}),o(z,null,{default:v(()=>t[4]||(t[4]=[O("Add Tag")])),_:1}),o(H),o(Q,null,{default:v(()=>[o(S,{variant:"text",onClick:T},{default:v(()=>t[5]||(t[5]=[O(" Save ")])),_:1})]),_:1})]),_:1}),o(q,null,{default:v(()=>[o(X,{fluid:!0},{default:v(()=>[o(Z,null,{default:v(()=>[o(R,{cols:"12"},{default:v(()=>[o(K,{label:A(b).formLabelDisplayName,type:"text",variant:"outlined",modelValue:g.value.Title,"onUpdate:modelValue":t[1]||(t[1]=d=>g.value.Title=d)},null,8,["label","modelValue"])]),_:1}),o(R,{cols:"12"},{default:v(()=>[o(K,{label:A(b).formLabelTagKey,type:"text",variant:"outlined",modelValue:g.value.Key,"onUpdate:modelValue":t[2]||(t[2]=d=>g.value.Key=d)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),De=k({__name:"SelectTags",props:C({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{},showKey:{type:Boolean,default:!1},showUuid:{type:Boolean,default:!1},inputType:{default:()=>u.UNKNOWN}},{modelValue:{required:!0},modelModifiers:{}}),emits:C(["change"],["update:modelValue"]),setup(e,{emit:N}){const s=W(e,"modelValue"),m=N,i=U([]),g=G(),c=U([]),T=U([]),f=U(""),t=U(""),d=U(u.UNKNOWN),p=L(()=>[...c.value,...T.value].map(n=>({title:`${n.Title}${e.showKey?` [ ${n.Key} ]`:""}${e.showUuid?` (${n.TagUUID})`:""}`,value:i.value.find(a=>a&&a.TagUUID&&a.TagUUID===n.TagUUID)||n})));typeof e.convention=="object"?(f.value=e.convention.ConventionUUID,t.value=e.convention.OrganisationUUID):f.value=e.convention||"",typeof e.organisation=="object"?t.value=e.organisation.OrganisationUUID:t.value.length===0&&(t.value=e.organisation||""),(async()=>{const l=[];f.value&&l.push(g.getConventionTags(f.value)),t.value&&l.push(g.getOrganisationTags(t.value));const n=await Promise.all(l);if(f.value&&t.value?(T.value=n[0].sort((a,r)=>a.Title.localeCompare(r.Title)),c.value=n[1].sort((a,r)=>a.Title.localeCompare(r.Title))):f.value&&n.length==1?T.value=n[0].sort((a,r)=>a.Title.localeCompare(r.Title)):t.value&&n.length==1&&(c.value=n[0].sort((a,r)=>a.Title.localeCompare(r.Title))),e.inputType===u.TAG||e.inputType===u.UNKNOWN&&Array.isArray(s.value))d.value=u.TAG,p.value.forEach(a=>{Array.isArray(s.value)&&s.value.find(D=>D.TagUUID===a.value.TagUUID)&&i.value.push(a.value)});else if(e.inputType===u.JSON||e.inputType===u.UNKNOWN&&typeof s.value=="string"){d.value=u.JSON;try{const a=JSON.parse(s.value);p.value.forEach(r=>{a.find(I=>I.TagUUID===r.value.TagUUID)&&i.value.push(r.value)})}catch{}}else if(e.inputType===u.UUID_ARRAY){d.value=u.UUID_ARRAY;try{const a=s.value,r=[...c.value,...T.value];i.value=a.map(D=>r.find(I=>I.TagUUID==D))}catch{}}else if(e.inputType===u.STRING){d.value=u.STRING;try{if(typeof s.value!="string")return;const a=JSON.parse(s.value),r=[...c.value,...T.value];i.value=a.map(D=>r.find(I=>I.TagUUID==D))}catch{}}})();const V=U(!1),$=()=>{V.value=!0},B=l=>{l.ConventionUUID&&l.ConventionUUID.length>0?T.value.push(l):l.OrganisationUUID&&l.OrganisationUUID.length>0&&c.value.push(l),i.value.push(l),y()},y=()=>{switch(d.value){default:case u.TAG:{s.value=i.value,m("change");break}case u.JSON:{s.value=JSON.stringify(i.value),m("change");break}case u.STRING:{s.value=JSON.stringify(i.value.map(l=>l&&l.TagUUID?l.TagUUID:"")),m("change");break}case u.UUID_ARRAY:{s.value=i.value.map(l=>l&&l.TagUUID?l.TagUUID:""),m("change");break}}};return Y(i,y),(l,n)=>(w(),j(P,null,[o(_,{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=a=>i.value=a),chips:l.chips,multiple:"",label:l.label||"Tags",variant:l.variant||"solo",hint:l.hint,"persistent-hint":!0,clearable:l.clearable,items:p.value,"item-title":"title","item-value":"value"},{"prepend-item":v(()=>[o(ee,{title:"New Tag",onClick:n[0]||(n[0]=a=>$())},{prepend:v(()=>[o(J,{icon:"mdi:mdi-plus"})]),_:1}),o(ae,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),o(le,{modelValue:V.value,"onUpdate:modelValue":n[3]||(n[3]=a=>V.value=a),scrollable:!0},{default:v(()=>[o(te,{convention:l.convention,organisation:l.organisation,onClose:n[2]||(n[2]=a=>V.value=!1),onSave:B},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}});export{u as I,De as _};
