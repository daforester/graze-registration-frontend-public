import{p as B,r as g,s as I,c as S,a as ie,w as E,o as ue,b as ce,d as A,u as de,t as L,e as W,f as Q,h as a,m as F,i as Y,j as X,k as q,E as Z,l as _,n as f,q as u,v as ee,x as U,y as me,z as G,A as R,B as ae,C as ve,D as H,F as x,G as ge,H as fe,I as pe,J as he,K as ye,T as Ve,L as _e,S as ke}from"./index-D1IdJcDr.js";import{G as Se,R as z,a as Te}from"./userData-Ct5iumXn.js";import{u as be}from"./useAvatar-C_boc_68.js";import{C as we}from"./canEditOrganisation-XLoPt1w1.js";import{C as D,G as M}from"./canDo-DUOXP-vd.js";import{C as Ce}from"./canViewOperations-BJIOSM5m.js";import{u as Ie}from"./useAdvancedMode-aE3pqcx2.js";import{u as O,V as Pe,m as Re,a as Le,b as Ne,c as te,d as oe,e as Be,f as Ee,g as Ue,h as xe,i as De,j as Me,k as Ae,l as Oe,n as He}from"./VGrid-Bv_0hRDR.js";import{u as le,m as ne,c as ze,a as Ge}from"./scopeId-A3cp4IWG.js";import{V as j,m as $e,a as Fe}from"./VToolbar-DakFPRLD.js";import{u as Ye,V as J,a as b,b as qe,c as je}from"./VList-dnLyDLDE.js";import{V as Je}from"./VSpacer-BrfhdX1T.js";import{V as Ke}from"./VTextField-W5fcvv2H.js";import{V as We,a as se}from"./VNavigationDrawer-CwBDCOTo.js";import{V as $,a as Qe}from"./forwardRefs-KgRCCg1e.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Xe}from"./index-zHJ-1AxG.js";import{V as K}from"./VContainer-Chowp3GE.js";import{V as Ze}from"./VApp-Dovpwko4.js";import"./useStoreAPI-DRgmhfwe.js";import"./createSimpleFunctional-B6u6eakS.js";import"./form-DXdcbEwW.js";const ea=(e,i=void 0)=>e===void 0?!1:i===void 0?D(e,M.GROUP_TYPE_CONVENTION).ManageUsers:D(e,M.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).ManageUsers,aa=(e,i=void 0)=>{let t;return e===void 0?!1:(i===void 0?t=D(e,M.GROUP_TYPE_CONVENTION):t=D(e,M.GROUP_TYPE_CONVENTION,i.ConventionUUID,i),t.EditConvention||t.ManageViews||t.ViewRegistration||t.EditRegistration)},ta=B({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function oa(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:t}=i;let d=0,o=0;const l=g(null),s=I(0),r=I(0),h=I(0),v=I(!1),c=I(!1),m=S(()=>Number(e.scrollThreshold)),T=S(()=>ie((m.value-s.value)/m.value||0)),y=()=>{const p=l.value;if(!p||t&&!t.value)return;d=s.value,s.value="window"in p?p.pageYOffset:p.scrollTop;const k=p instanceof Window?document.documentElement.scrollHeight:p.scrollHeight;if(o!==k){o=k;return}c.value=s.value<d,h.value=Math.abs(s.value-m.value)};return E(c,()=>{r.value=r.value||s.value}),E(v,()=>{r.value=0}),ue(()=>{E(()=>e.scrollTarget,p=>{var C;const k=p?document.querySelector(p):window;k&&k!==l.value&&((C=l.value)==null||C.removeEventListener("scroll",y),l.value=k,l.value.addEventListener("scroll",y,{passive:!0}))},{immediate:!0})}),ce(()=>{var p;(p=l.value)==null||p.removeEventListener("scroll",y)}),t&&E(t,y,{immediate:!0}),{scrollThreshold:m,currentScroll:s,currentThreshold:h,isScrollActive:v,scrollRatio:T,isScrollingUp:c,savedScroll:r}}const la=B({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...$e(),...ne(),...ta(),height:{type:[Number,String],default:64}},"VAppBar"),na=A()({name:"VAppBar",props:la(),emits:{"update:modelValue":e=>!0},setup(e,i){let{slots:t}=i;const d=g(),o=de(e,"modelValue"),l=S(()=>{var V;const n=new Set(((V=e.scrollBehavior)==null?void 0:V.split(" "))??[]);return{hide:n.has("hide"),fullyHide:n.has("fully-hide"),inverted:n.has("inverted"),collapse:n.has("collapse"),elevate:n.has("elevate"),fadeImage:n.has("fade-image")}}),s=S(()=>{const n=l.value;return n.hide||n.fullyHide||n.inverted||n.collapse||n.elevate||n.fadeImage||!o.value}),{currentScroll:r,scrollThreshold:h,isScrollingUp:v,scrollRatio:c}=oa(e,{canScroll:s}),m=L(()=>l.value.hide||l.value.fullyHide),T=S(()=>e.collapse||l.value.collapse&&(l.value.inverted?c.value>0:c.value===0)),y=S(()=>e.flat||l.value.fullyHide&&!o.value||l.value.elevate&&(l.value.inverted?r.value>0:r.value===0)),p=S(()=>l.value.fadeImage?l.value.inverted?1-c.value:c.value:void 0),k=S(()=>{var N,w;if(l.value.hide&&l.value.inverted)return 0;const n=((N=d.value)==null?void 0:N.contentHeight)??0,V=((w=d.value)==null?void 0:w.extensionHeight)??0;return m.value?r.value<h.value||l.value.fullyHide?n+V:n:n+V});W(()=>!!e.scrollBehavior,()=>{Q(()=>{m.value?l.value.inverted?o.value=r.value>h.value:o.value=v.value||r.value<h.value:o.value=!0})});const{ssrBootStyles:C}=Ye(),{layoutItemStyles:P}=le({id:e.name,order:S(()=>parseInt(e.order,10)),position:L(()=>e.location),layoutSize:k,elementSize:I(void 0),active:o,absolute:L(()=>e.absolute)});return O(()=>{const n=j.filterProps(e);return a(j,F({ref:d,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...P.value,"--v-toolbar-image-opacity":p.value,height:void 0,...C.value},e.style]},n,{collapse:T.value,flat:y.value}),t)}),{}}}),sa=B({...Re({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),ra=A()({name:"VAppBarNavIcon",props:sa(),setup(e,i){let{slots:t}=i;return O(()=>a(Pe,F(e,{class:["v-app-bar-nav-icon"]}),t)),{}}}),ia=B({...te(),...Ne(),...Ge()},"VLayout"),ua=A()({name:"VLayout",props:ia(),setup(e,i){let{slots:t}=i;const{layoutClasses:d,layoutStyles:o,getLayoutItem:l,items:s,layoutRef:r}=ze(e),{dimensionStyles:h}=Le(e);return O(()=>{var v;return a("div",{ref:r,class:[d.value,e.class],style:[h.value,o.value,e.style]},[(v=t.default)==null?void 0:v.call(t)])}),{getLayoutItem:l,items:s}}}),ca=Y({__name:"DashboardLayout",props:{user:{}},setup(e){const i=be(),t=X(),d=g(!1),o=g("Default Title"),l=g(""),s=g(q(e.user)),r=g(i(s.value.UserUUID)),h=Z.getInstance();Ie(),h.on("user.profile.saved",P=>{s.value=q(P)});const v=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",c=g(localStorage.getItem("theme")||v());t.global.name.value=c.value;const m=()=>{c.value=="light"?c.value="dark":c.value="light",t.global.name.value=c.value,localStorage.setItem("theme",c.value)},T=async P=>{o.value=P;const n=await ae();document.title=`${n!=null&&n.Name?`${n.Name} - `:""} ${o.value}`},y=g(aa(e.user)),p=g(Ce(e.user)),k=g(we(e.user)),C=g(ea(e.user));return(P,n)=>{const V=G("RouterLink"),N=G("RouterView");return f(),_(ua,{class:"h-100"},{default:u(()=>[a(na,{color:"blue-darken-3"},{default:u(()=>[a(Fe,null,{default:u(()=>[ee(U(o.value),1)]),_:1}),a(Je),a(Ke,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=w=>l.value=w),"prepend-inner-icon":"mdi:mdi-magnify",label:"Search",variant:"underlined","hide-details":"",clearable:!0,class:"d-none"},null,8,["modelValue"]),a(ra,{variant:"text",onClick:n[1]||(n[1]=me(w=>d.value=!d.value,["stop"]))})]),_:1}),a(We,{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=w=>d.value=w),location:"right",temporary:!0},{default:u(()=>[a(J,null,{default:u(()=>[a(V,{to:{name:"Profile"}},{default:u(()=>[a(b,{title:s.value.DisplayName},{prepend:u(()=>[r.value?(f(),_($,{key:0,src:r.value,class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])):(f(),_(oe,{key:1,icon:"mdi:mdi-account-circle",size:"x-large"}))]),_:1},8,["title"])]),_:1})]),_:1}),a(qe),a(N,{name:"navigation"},{default:u(()=>[a(J,null,{default:u(()=>[a(V,{to:"/"},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-view-dashboard-outline",title:"Home",value:"home"})]),_:1}),y.value||k.value||C.value?(f(),_(je,{key:0,value:"Admin"},{activator:u(({props:w})=>[a(b,F(w,{"prepend-icon":"mdi:mdi-security",title:"Admin"}),null,16)]),default:u(()=>[y.value||p.value?(f(),_(V,{key:0,to:"/admin/conventions"},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-domain",title:"Conventions",value:"Conventions"})]),_:1})):R("",!0),k.value||y.value?(f(),_(V,{key:1,to:"/admin/email/templates"},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-email-edit-outline",title:"Email Templates",value:"Email Templates"})]),_:1})):R("",!0),k.value?(f(),_(V,{key:2,to:"/admin/organisations"},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-store",title:"Organisations",value:"Organisations"})]),_:1})):R("",!0),C.value?(f(),_(V,{key:3,to:"/admin/groups"},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-key-chain-variant",title:"Permissions",value:"Permissions"})]),_:1})):R("",!0)]),_:1})):R("",!0),a(V,{to:{name:"Profile"}},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-account-circle",title:"Manage Account"})]),_:1}),a(b,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:m,title:`${c.value=="light"?"Dark":"Light"} Mode`},null,8,["title"]),a(V,{to:"/logout"},{default:u(()=>[a(b,{"prepend-icon":"mdi:mdi-logout",title:"Logout",value:"Logout"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(se,null,{default:u(()=>[a(N,{onPageTitle:T,"logged-in":!0})]),_:1})]),_:1})}}}),da=re(ca,[["__scopeId","data-v-142cf0ca"]]),ma="/assets/graze-logo-CM-MvGxq.svg",va={key:2},ga={key:3},fa=Y({__name:"LoginLayout",async setup(e){let i,t;const d=X(),o=g();o.value=([i,t]=ve(()=>ae()),i=await i,t(),i),document.title=`${o.value?`${o.value.Name} - `:"Convention"} Registration System`;const l=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",s=g(localStorage.getItem("theme")||l());return d.global.name.value=s.value,(r,h)=>{const v=G("RouterView");return f(),H(fe,null,[a(K,{class:"logo-container text-center"},{default:u(()=>{var c;return[o.value&&o.value.Logo?(f(),_($,{key:0,src:o.value.Logo,class:"graze-logo ma-auto"},null,8,["src"])):(f(),_($,{key:1,src:x(ma),class:"graze-logo ma-auto"},null,8,["src"])),o.value&&o.value.RegTitle?(f(),H("h1",va,U(o.value.RegTitle),1)):(f(),H("h1",ga,U(((c=o.value)==null?void 0:c.Name)||"Graze")+" Registration System",1))]}),_:1}),a(K,{class:"login-container text-center mb-0 rounded rounded-lg mb-md-10"},{default:u(()=>[a(Qe,null,{default:u(()=>[a(oe,{class:"ma-2 pa-5 bg-indigo rounded-circle",color:"white",icon:"mdi:mdi-lock-outline"})]),_:1}),ge("h2",null,U(x(Xe).headingSignIn),1),a(v,{"logged-in":!1})]),_:1})],64)}}}),pa=re(fa,[["__scopeId","data-v-9ce1b973"]]),ha=B({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...He(),...te(),...Oe(),...ne(),...Ae(),...Me({tag:"footer"}),...ye()},"VFooter"),ya=A()({name:"VFooter",props:ha(),setup(e,i){let{slots:t}=i;const d=g(),{themeClasses:o}=pe(e),{backgroundColorClasses:l,backgroundColorStyles:s}=Be(()=>e.color),{borderClasses:r}=Ee(e),{elevationClasses:h}=Ue(e),{roundedClasses:v}=xe(e),c=I(32),{resizeRef:m}=De(y=>{y.length&&(c.value=y[0].target.clientHeight)}),T=S(()=>e.height==="auto"?c.value:parseInt(e.height,10));return W(()=>e.app,()=>{const y=le({id:e.name,order:S(()=>parseInt(e.order,10)),position:L(()=>"bottom"),layoutSize:T,elementSize:S(()=>e.height==="auto"?void 0:T.value),active:L(()=>e.app),absolute:L(()=>e.absolute)});Q(()=>{d.value=y.layoutItemStyles.value})}),O(()=>a(e.tag,{ref:m,class:["v-footer",o.value,l.value,r.value,h.value,v.value,e.class],style:[s.value,e.app?d.value:{height:he(e.height)},e.style]},t)),{}}}),za=Y({__name:"Default",emits:["pageTitle"],setup(e,{emit:i}){let t=Se();const d=Ve.getInstance(),o=d.getTokenByService("GrazeAPI"),l=_e(),s=g(!1),r=g(!1),h=i,v=Z.getInstance();v.on("login",m=>{t=m,s.value=!0}),v.on("logout",()=>{t=void 0,s.value=!1}),v.on("tokenManager.tokenUpdated",()=>{s.value=!0,r.value=!0}),v.on("tokenManager.sessionExpired",()=>{s.value=!1,r.value=!1,z(),location.reload()}),v.on("maintenance-mode",m=>{m&&l.push("/maintenance")}),o?t?o.AccessExpires<=Date.now()&&o.RefreshExpires>Date.now()?d.refreshToken(o):o.AccessExpires>Date.now()?(z(),s.value=!1,r.value=!0):(s.value=!0,r.value=!0):Te().then(m=>{t=m,s.value=!0,r.value=!0}).catch(()=>{s.value=!1,r.value=!0}):(z(),s.value=!1,r.value=!0);const c=m=>{h("pageTitle",m)};return(m,T)=>(f(),_(ke,null,{default:u(()=>[a(Ze,{class:"bg-image"},{default:u(()=>[r.value?(f(),_(se,{key:0},{default:u(()=>[s.value&&x(t)?(f(),_(da,{key:0,user:x(t),onPageTitle:c},null,8,["user"])):(f(),_(pa,{key:1}))]),_:1})):R("",!0),a(ya,null,{default:u(()=>T[0]||(T[0]=[ee(" Powered by Graze ")])),_:1})]),_:1})]),_:1}))}});export{za as default};
